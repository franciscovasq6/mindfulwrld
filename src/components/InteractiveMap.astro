---
interface MapMarker {
  lat: number;
  lng: number;
  title: string;
  url: string;
}

interface Props {
  markers: MapMarker[];
}

const { markers } = Astro.props;
---

<div id="travel-map" class="map-container"></div>

<style>
  .map-container {
    width: 100%;
    height: 500px;
    background-color: #E2689E;
    border-radius: var(--border-radius-lg);
    overflow: hidden;
  }

  :global(.leaflet-container) {
    background-color: #E2689E !important;
  }

  :global(.leaflet-tile-pane) {
    opacity: 0;
  }

  :global(.leaflet-control-attribution) {
    display: none;
  }

  :global(.leaflet-control-zoom) {
    border: 2px solid white !important;
    border-radius: 8px !important;
  }

  :global(.leaflet-control-zoom a) {
    background-color: white !important;
    color: #E2689E !important;
  }

  :global(.leaflet-control-zoom a:hover) {
    background-color: #f5f5f5 !important;
  }

  :global(.custom-marker) {
    background-color: white;
    border: 3px solid #E2689E;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  :global(.custom-marker:hover) {
    transform: scale(1.3);
    background-color: #61CE70;
  }

  :global(.leaflet-popup-content-wrapper) {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  :global(.leaflet-popup-content) {
    margin: 12px;
    font-family: var(--font-sans);
  }

  :global(.leaflet-popup-content a) {
    color: #E2689E;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
  }

  :global(.leaflet-popup-content a:hover) {
    text-decoration: underline;
  }

  :global(.leaflet-popup-tip) {
    background-color: white;
  }
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script define:vars={{ markers }}>
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize map
    const map = L.map('travel-map', {
      center: [20, 0],
      zoom: 2,
      minZoom: 2,
      maxZoom: 6,
      zoomControl: true,
      scrollWheelZoom: false,
      doubleClickZoom: true,
    });

    // Add pink world map overlay
    const worldMapSVG = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 1001" width="2000" height="1001">
        <path fill="white" d="M 0,0 L 2000,0 L 2000,1001 L 0,1001 Z" fill-opacity="0.3"/>
        <!-- Simplified world map paths would go here -->
      </svg>
    `;

    // Add markers for each blog post
    markers.forEach(marker => {
      const customIcon = L.divIcon({
        className: 'custom-marker',
        iconSize: [20, 20],
        iconAnchor: [10, 10],
        popupAnchor: [0, -10]
      });

      const mapMarker = L.marker([marker.lat, marker.lng], { icon: customIcon })
        .addTo(map)
        .bindPopup(`<a href="${marker.url}">${marker.title}</a>`);

      // Navigate on marker click
      mapMarker.on('click', () => {
        window.location.href = marker.url;
      });
    });
  });
</script>
